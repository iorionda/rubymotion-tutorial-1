
<!doctype html>
  <head>
    <title> Animations |  RubyMotion Tutorial</title>
    <meta name="description" content="Animate UIViews in RubyMotion with CoreAnimation" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="robots" content="all" />
    <meta name="MSSmartTagsPreventParsing" content="true" />
    <meta name="author" content="Clay Allsopp" />

    <meta property="og:title" content="RubyMotion Tutorial: Write iOS apps in Ruby" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://tutorial.rubymotion.jp/" />
    <meta property="og:image" content="http://i.imgur.com/mndCd.png" />
    <meta property="og:site_name" content="RubyMotion Tutorial" />
    <meta property="og:description" content="Learn to write iOS apps in Ruby.">

    <meta name=viewport content="width=device-width, initial-scale=1.0,maximum-scale = 1.0">

    <link rel=stylesheet href='http://clayallsopp.github.com/rubymotion-tutorial/css/bootstrap.min.css'>
    <link rel=stylesheet href='http://clayallsopp.github.com/rubymotion-tutorial/css/bootstrap-responsive.min.css'>
    <link rel=stylesheet href='http://clayallsopp.github.com/rubymotion-tutorial/css/blog/pygments.css'>
    <link rel=stylesheet href='http://clayallsopp.github.com/rubymotion-tutorial/css/patch.css'>
    <link rel=stylesheet href='http://clayallsopp.github.com/rubymotion-tutorial/css/chapter.css'>
    

  </head>

  <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <a id="fork-me" href="https://github.com/RubyMotionJP/rubymotion-tutorial" target="_blank">Fork me on GitHub</a>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2" id="derp">
            <nav>
            <ul class="nav nav-list">
              <li class="nav-header" id="chapter-nav-btn">
                Chapters <i class="icon-chevron-up" id="chapter-nav-chevron"></i>
              </li>
            </ul>
            <ul class="nav nav-list" id="chapter-nav">
              
                <li >
                  <a href="/0-in-motion">In Motion</a>
                </li>
              
                <li >
                  <a href="/1-hello-motion">Hello Motion</a>
                </li>
              
                <li >
                  <a href="/2-views">Views</a>
                </li>
              
                <li >
                  <a href="/3-controllers">Controllers</a>
                </li>
              
                <li >
                  <a href="/4-containers">Containers</a>
                </li>
              
                <li >
                  <a href="/5-tables">Tables</a>
                </li>
              
                <li  class="active" >
                  <a href="/6-animations">Animations</a>
                </li>
              
                <li >
                  <a href="/7-models">Models</a>
                </li>
              
                <li >
                  <a href="/8-testing">Testing</a>
                </li>
              
                <li >
                  <a href="/9-http">HTTP</a>
                </li>
              
                <li >
                  <a href="/10-api-driven-example">API Driven Example</a>
                </li>
              
            </ul>
            <ul class="nav nav-list">
              <li class="divider"></li>
              <li><a href="/">Home</a></li>
              <li><a href="https://github.com/RubyMotionJP/rubymotion-tutorial">Source</a></li>
              <li class="divider"></li>
            </ul>
          </nav>
        </div>
        <div class="span10" id="content">
          <div id="main">
            <h1 id="toc_17">Animations</h1>

<p>みなさんが iOS と他のモバイル OS との最大の違いについてユーザに尋ねると、アニメーションは間違いなくトップの答えのひとつとなるでしょう。フェード、フリップ、回転、バウンド、カールは Apple のアプリにありふれています。</p>

<p>これらのいくつかはデフォルトの UI 要素 (<code>UINavigationController</code>, <code>UITableView</code> など) で顕著です。そして本当に素晴らしいことは、それらはすべて同じ API に基づいて構築されているということです。文字通り、<code>UIView</code> はたった 1 行のコードでアニメーションできます。それは信じられないくらい素晴らしいことです。</p>

<p>さぁ、さっそくいくつか遊んでみましょう。画面の周りにボックスを移動させてみましょう。私を信じてください。コードは今述べた通りにシンプルです。</p>

<p><code>window</code> にビューを追加することから始め、そして設定したポイントの周辺でアニメーションします。これは比較的に短いので、ここで <code>AppDelegate</code> のすべての変更を破棄しましょう。</p>
<div class="highlight"><pre class='codehilite'><code class="ruby syntax"><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>
  <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">applicationFrame</span><span class="p">)</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>

  <span class="c1"># the points we&#39;re going to animate to</span>
  <span class="vi">@points</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="o">]]</span>
  <span class="vi">@current_index</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="c1"># usual method of adding views to our window</span>
  <span class="vi">@view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span> <span class="o">[</span><span class="vi">@points</span><span class="o">[</span><span class="vi">@current_index</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">]]</span>
  <span class="vi">@view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">blueColor</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@view</span><span class="p">)</span>

  <span class="n">animate_to_next_point</span>

  <span class="kp">true</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">animate_to_next_point</span>
  <span class="vi">@current_index</span> <span class="o">+=</span> <span class="mi">1</span>

  <span class="c1"># keep current_index in the range [0,3]</span>
  <span class="vi">@current_index</span> <span class="o">=</span> <span class="vi">@current_index</span> <span class="o">%</span> <span class="vi">@points</span><span class="o">.</span><span class="n">count</span>

  <span class="no">UIView</span><span class="o">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">animations</span><span class="p">:</span> <span class="nb">lambda</span> <span class="p">{</span>
       <span class="vi">@view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[</span><span class="vi">@points</span><span class="o">[</span><span class="vi">@current_index</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">]]</span>
    <span class="p">},</span>
    <span class="n">completion</span><span class="ss">:lambda</span> <span class="p">{</span><span class="o">|</span><span class="n">finished</span><span class="o">|</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">animate_to_next_point</span>
    <span class="p">}</span>
  <span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p>このコードには新しく登場したものが 2 つあります。最初に、<code>[[0, 0], [100, 100]]</code> という構文は <code>frame</code> のためのものです。入れ子にした配列はこれまで使ってきた <code>CGRectMake</code> を簡略化したものです。最初の配列は <code>origin</code> の値を表し、二つ目の配列は <code>size</code> の値を表しています。<code>frame</code> を変更するために <code>@points</code> を簡単に使用することができ、素晴らしいことです。</p>

<p>二つ目は <code>lambda</code> です。もしこの用語を慣れていなければ、<code>lambda</code> は伝統的に小さな関数で変数が割り当てられたり引数が渡されたりするものです。たとえば、<code>my_lambda = lambda { p &quot;Hello!&quot; }</code> とすることができます。ここで <code>my_lambda.call</code> を実行すると、<code>lambda</code> ブロック内のコードが実行されます。<code>lambda</code> は引数を持つこともできます。</p>
<div class="highlight"><pre class='codehilite'><code class="ruby syntax"><span class="n">my_lambda</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="nb">p</span> <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span> <span class="p">}</span>
<span class="n">my_lambda</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;Clay&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="no">Hello</span> <span class="no">Clay</span>
</code></pre>
</div>

<p>さて、アニメーションの例に戻りましょう。いつものような window を作成し、ボックスを移動するためにいくつかポイントを定義します。window にボックス (<code>@view</code>) を追加し、<code>animate_to_next_point</code> を開始することでよく知られたマジックが起こります。</p>

<p><code>UIView.animateWithDuration:animations:completion:</code> はアニメーションを制御するものです。たくさんのパーツがこのメソッドにあるので、ひとつずつ見ていきましょう。</p>

<p><code>duration</code> にはアニメーションをどのくらい継続するかを秒単位で設定します。<code>1.85</code> のように float の値を使うこともできます。指にとって良いルールは &quot;素早い&quot; アニメーションは <code>.3</code> 秒にされることです。</p>

<p><em>任意の</em> ビューに対して <code>animations:</code> の lambda で行った変更がスムーズにアニメーションされます。なんてクールなんでしょう！？Android と比較すると、Android では望むアニメーションのために各プロパティの独自の <code>Animation</code> オブジェクトを作成する必要があります。さて、いくつかのプロパティはアニメーションできませんが、<code>frame</code>, <code>bounds</code> や <code>alpha</code> といった一般的なものは問題なく動きます (完全なリスト <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/uiview_class/uiview/uiview.html#Overview_section">this</a> をチェックしてください)。私たちの場合では、<code>@view.frame</code> の値を <code>@points</code> で用意してある次の origin に設定します。</p>

<p>最後に、<code>completions:</code> はアニメーションが終了した後で呼び出されます。この lambda では <em>必ず</em> 引数を受け付ける必要があります。アニメーションが本当に終了したかを通知する <code>boolean</code> の値になります。他のアニメーションを明示的に行う場合にのみ、それによってアニメーションが取り消されるため、アニメーションは失敗となることがあります。</p>

<p><code>rake</code> を実行し、シミュレータの左上の角をスライドする青いボックスが表示されます。とても簡単でしたよね？</p>

<p><img src="images/1.png" alt="simple box animations"></p>

<p>私はこんなに簡単であったという衝撃を忘れることができません。さきほどのアニメーションに 1) delay を持たせる 2) 別の &quot;アニメーションカーブ&quot; を持たせる、と変更することでスパイスを振りかけましょう。慣れていない？現在のアニメーションを見てみましょう。各ポイントの間で、ボックスがスピードアップしスローダウンのしかたに気がつきました？詳しく見てみましょう。</p>

<p>この動きになる理由は、iOS のデフォルトのアニメーションカーブが <code>UIViewAnimationOptionCurveEaseInOut</code> だからです。実際の生活のなかで頻繁におこる動き方をシミュレートしていて本当に素晴らしいエフェクトです。私たちは素早く方向転換しませんし、徐々にスピードをあげます。いろいろ遊ぶために、別のカーブを使ってみましょう。</p>

<p>これまで使ってきた <code>animateWithDuration:animations:completion:</code> をより設定項目のあるものに変更します。<code>animateWithDuration:delay:options:animations:completion:</code> はアニメーションを開始する前に delay を追加し、また <code>options</code> を設定できます。<code>delay</code> は秒単位の値を取り、<code>animations:</code> ブロックの開始までのオフセットとなります。</p>

<p><code>options</code> は少し複雑です。<code>UIViewAnimationOption</code> というプレフィックスの値で integer のビットマスクを取ります。<code>(0 | 1 | 4) == 5</code> のように Ruby でビットマスクを行うことができます。リニアなアニメーションカーブと自動的にアニメーションを繰り返すというような、同時に複数のアニメーションオプションを組み合わせたい場合に備えビットマスクになっています(<code>options: (UIViewAnimationOptionCurveLinear | UIViewAnimationOptionRepeat)</code>)。</p>

<p>(<code>UIView.animate...</code> でより設定項目が少ない <code>animateWithDuration:animations:</code> というものもあります)。</p>

<p>とにかく、動かしてみましょう。<code>animate_to_next_point</code> メソッドを次のように変更します。</p>
<div class="highlight"><pre class='codehilite'><code class="ruby syntax"><span class="k">def</span> <span class="nf">animate_to_next_point</span>
  <span class="vi">@current_index</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="vi">@current_index</span> <span class="o">=</span> <span class="vi">@current_index</span> <span class="o">%</span> <span class="vi">@points</span><span class="o">.</span><span class="n">count</span>

  <span class="no">UIView</span><span class="o">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">delay</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="no">UIViewAnimationOptionCurveLinear</span><span class="p">,</span>
    <span class="n">animations</span><span class="p">:</span> <span class="nb">lambda</span> <span class="p">{</span>
       <span class="vi">@view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[</span><span class="vi">@points</span><span class="o">[</span><span class="vi">@current_index</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="o">]]</span>
    <span class="p">},</span> <span class="n">completion</span><span class="ss">:lambda</span> <span class="p">{</span><span class="o">|</span><span class="n">finished</span><span class="o">|</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">animate_to_next_point</span>
    <span class="p">})</span>
<span class="k">end</span>
</code></pre>
</div>

<p><code>rake</code> を実行し、新しいアニメーションをチェックしましょう。</p>

<p>古くさいもののように見えますが、その動作はかなり異なっていますよね？ポイント間でいくらか時間がかかるようになり、スライドはよりメカニカルです。</p>

<h2 id="toc_18">You Know This Section</h2>

<p>iOS の基本的なアニメーションを扱ってきました。これまでどんなことをやってきましたか？</p>

<ul>
<li><code>animateWithDuration:animations:</code> と類似したものを使い、ビューのプロパティを <code>animations:</code> の lambda で変更することでアニメーションが動きました。</li>
<li>アニメーションカーブによってアニメーションの動作が決まります。<code>UIViewAnimationOptionCurveLinear</code> と <code>UIViewAnimationOptionCurveEaseInOut</code> を例として扱いました。</li>
</ul>

<p><a href="/7-models">次の章ではモデルを学びます。いつやるか？今でしょう！</a></p>

          </div>
          <hr />
          <h2>Like it?<small id="spread"> Spread the word</small></h2>
          <div id="social">
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tutorial.rubymotion.jp" data-text="RubyMotion Tutorial: Make iOS Apps With Ruby" data-size="large" data-related="rubymotionjp" data-count="none">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

            <div class="fb-like" data-href="http://tutorial.rubymotion.jp/" data-send="true" data-width="450" data-show-faces="true"></div>
          </div>
          <hr />
        </div>
      </div>
    </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src='http://clayallsopp.github.com/rubymotion-tutorial/js/bootstrap.min.js' type="text/javascript"></script>
  <script src='http://clayallsopp.github.com/rubymotion-tutorial/js/chapters.js' type="text/javascript"></script>
  </body>
</html>